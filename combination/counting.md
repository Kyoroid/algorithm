# 数え上げ

## $nCk \pmod{p}$ の計算

### $n$が大きく、$k$が小さいとき

$$_nC_k = \frac{n!}{k!(n-k)!} = \frac{n(n-1) \ldots (n-k+1)}{k(k-1) \ldots 1}$$

分母、分子とも$k$個の整数の積なので、全体の計算量はクエリ毎に$O(k)$。


### $n$が小さいとき

$$_nC_k = \frac{n!}{k!(n-k)!} = n!(k!)^{-1}((n-k)!)^{-1}$$

$n$以下の全ての$k'$に対して$k'!, (k'!)^{-1}$ の2種類の値を事前計算しておくことで、クエリ毎に$O(1)$で計算可能となる。

$k'!$については逐次計算し、その値を記憶しておく。

$(k'!)^{-1}$の計算については、逆元を使って求めると計算量は$O(\log(p))$となる。  
実は漸化式 $((k'-1)!)^{-1} = k' \cdot (k'!)^{-1}$ が成り立つので、 $k'=n$ のときだけ計算すれば十分。その他は$O(1)$で求まる。

事前計算は$O(n)$、クエリ毎に$O(1)$。
